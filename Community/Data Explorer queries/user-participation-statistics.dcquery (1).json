{
    "query": {
        "id": 9,
        "sql": "-- [params]\n-- int :from_days_ago = 0\n-- int :duration_days = 30\nWITH t AS (\n    SELECT CURRENT_TIMESTAMP - ((:from_days_ago + :duration_days) * (INTERVAL '1 days')) AS START,\n        CURRENT_TIMESTAMP - (:from_days_ago * (INTERVAL '1 days')) AS END\n),\npr AS (\n    SELECT user_id, COUNT(1) AS visits,\n        SUM(posts_read) AS posts_read\n    FROM user_visits, t\n    WHERE posts_read > 0\n        AND visited_at > t.START\n        AND visited_at < t.\n        END\n    GROUP BY\n        user_id\n),\npc AS (\n    SELECT user_id, COUNT(1) AS posts_created\n    FROM posts, t\n    WHERE\n        created_at > t.START\n        AND created_at < t.\n        END\n    GROUP BY\n        user_id\n),\nttopics AS (\n    SELECT user_id, posts_count\n    FROM topics, t\n    WHERE created_at > t.START\n        AND created_at < t.\n        END\n),\ntc AS (\n    SELECT user_id, COUNT(1) AS topics_created\n    FROM ttopics\n    GROUP BY user_id\n),\ntwr AS (\n    SELECT user_id, COUNT(1) AS topics_with_replies\n    FROM ttopics\n    WHERE posts_count > 1\n    GROUP BY user_id\n),\ntv AS (\n    SELECT user_id,\n        COUNT(DISTINCT(topic_id)) AS topics_viewed\n    FROM topic_views, t\n    WHERE viewed_at > t.START\n        AND viewed_at < t.\n        END\n    GROUP BY user_id\n),\nlikes AS (\n    SELECT post_actions.user_id AS given_by_user_id,\n        posts.user_id AS received_by_user_id\n    FROM t,\n        post_actions\n        LEFT JOIN\n        posts\n        ON post_actions.post_id = posts.id\n    WHERE\n        post_actions.created_at > t.START\n        AND post_actions.created_at < t.\n        END\n        AND post_action_type_id = 2\n),\nlg AS (\n    SELECT given_by_user_id AS user_id,\n        COUNT(1) AS likes_given\n    FROM likes\n    GROUP BY user_id\n),\nlr AS (\n    SELECT received_by_user_id AS user_id,\n        COUNT(1) AS likes_received\n    FROM likes\n    GROUP BY user_id\n),\ne AS (\n    SELECT email, user_id\n    FROM user_emails u\n    WHERE u.PRIMARY = TRUE\n)\nSELECT\n    pr.user_id,\n    username,\n    name,\n    email,\n    visits,\n    COALESCE(topics_viewed, 0) AS topics_viewed,\n    COALESCE(posts_read, 0) AS posts_read,\n    COALESCE(posts_created, 0) AS posts_created,\n    COALESCE(topics_created, 0) AS topics_created,\n    COALESCE(topics_with_replies, 0) AS topics_with_replies,\n    COALESCE(likes_given, 0) AS likes_given,\n    COALESCE(likes_received, 0) AS likes_received\nFROM pr\nLEFT JOIN tv USING (user_id)\nLEFT JOIN pc USING (user_id)\nLEFT JOIN tc USING (user_id)\nLEFT JOIN twr USING (user_id)\nLEFT JOIN lg USING (user_id)\nLEFT JOIN lr USING (user_id)\nLEFT JOIN e USING (user_id)\nLEFT JOIN users ON pr.user_id = users.id\nORDER BY\n    visits DESC,\n    posts_read DESC,\n    posts_created DESC\n",
        "name": "User Participation Statistics",
        "description": "Detailed statistics for the most active users.",
        "param_info": [
            {
                "identifier": "from_days_ago",
                "type": "int",
                "default": "0",
                "nullable": false
            },
            {
                "identifier": "duration_days",
                "type": "int",
                "default": "30",
                "nullable": false
            }
        ],
        "created_at": "2020-11-18T17:59:13.549Z",
        "username": "OdysLam",
        "group_ids": [],
        "last_run_at": "2020-11-23T15:50:08.681Z",
        "hidden": false,
        "user_id": 233
    }
}